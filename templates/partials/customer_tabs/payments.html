<div class="card p-3">
  <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
    <div>
      <div class="fw-semibold">Payment History</div>
      <div class="small muted">
        {{ payments|length }} payments - GHS {{ "{:,.2f}".format(payments|sum(attribute='amount') or 0) }}
        {% if showing_limit %}<span class="ms-1">(Showing latest 300)</span>{% endif %}
      </div>
    </div>
    <div class="row g-2 filter-row">
      <div class="col-12 col-md">
        <input class="form-control form-control-sm" id="payFilterDate" placeholder="Filter by date (YYYY-MM-DD)">
      </div>
      <div class="col-6 col-md">
        <input class="form-control form-control-sm" id="payFilterMethod" placeholder="Method">
      </div>
      <div class="col-6 col-md">
        <input class="form-control form-control-sm" id="payFilterType" placeholder="Type">
      </div>
    </div>
  </div>
  <div class="table-wrap">
    <table class="table table-sm mb-0">
      <thead>
        <tr>
          <th>Date</th>
          <th>Amount</th>
          <th>Method</th>
          <th>Payment Type</th>
          <th>Note</th>
        </tr>
      </thead>
      <tbody id="paymentsBody">
        {% if payments and payments|length > 0 %}
          {% for payment in payments %}
          <tr data-date="{{ payment.date[:10] }}" data-method="{{ payment.method or '' }}" data-type="{{ payment.payment_type or '' }}">
            <td>{{ payment.date[:10] }}</td>
            <td>GHS {{ "{:,.2f}".format(payment.amount or 0) }}</td>
            <td>{{ payment.method }}</td>
            <td>{{ payment.payment_type or "N/A" }}</td>
            <td>{{ payment.note or "N/A" }}</td>
          </tr>
          {% endfor %}
        {% else %}
          <tr><td colspan="5" class="text-muted">No payments recorded yet.</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>
