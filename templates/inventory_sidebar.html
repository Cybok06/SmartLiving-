<!-- templates/inventory_sidebar.html -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>

<style>
  :root{
    --ink:#0f172a; --muted:#64748b; --line:#e2e8f0; --bg:#ffffff; --soft:#f8fafc; --brand:#0d6efd;
    --sidebar-w:260px; --sidebar-w-collapsed:72px; --sidebar-mobile: clamp(260px, 84vw, 360px);
    --gutter:16px;
  }

  html,body{background:var(--soft); color:var(--ink); font:16px/1.5 system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial}
  a{text-decoration:none}

  /* Topbar (fixed 56px) */
  .inv-topbar{
    position:fixed; top:0; left:0; right:0; height:56px; background:var(--bg);
    border-bottom:1px solid var(--line); z-index:1025;
    display:flex; align-items:center; gap:.75rem; padding:0 var(--gutter);
  }
  .inv-top-title{ font-weight:700; letter-spacing:.2px }
  .inv-top-spacer{ flex:1 }
  .inv-top-user{ color:var(--muted); font-size:.95rem }

  /* Hamburger */
  .inv-hambtn{ border:none; background:transparent; padding:10px; border-radius:12px; min-width:44px; min-height:44px }
  .inv-hambtn:focus-visible{ outline:2px solid #cfe3ff; outline-offset:2px }
  .hamburger{ width:26px; height:20px; position:relative; display:inline-block }
  .hamburger span{
    position:absolute; left:0; right:0; height:2px; background:var(--ink); border-radius:4px;
    transition:transform .28s ease, top .28s ease, opacity .2s ease;
  }
  .hamburger span:nth-child(1){ top:0 }
  .hamburger span:nth-child(2){ top:9px }
  .hamburger span:nth-child(3){ top:18px }
  body.inv-open .hamburger span:nth-child(1){ top:9px; transform:rotate(45deg) }
  body.inv-open .hamburger span:nth-child(2){ opacity:0 }
  body.inv-open .hamburger span:nth-child(3){ top:9px; transform:rotate(-45deg) }
  @media (min-width: 992px){
    body.inv-collapsed .hamburger span:nth-child(1){ transform:translateY(9px) }
    body.inv-collapsed .hamburger span:nth-child(2){ opacity:1 }
    body.inv-collapsed .hamburger span:nth-child(3){ transform:translateY(-9px) }
  }

  /* Sidebar */
  .inv-sidebar{
    position:fixed; inset:56px auto 0 0; width:var(--sidebar-w); background:var(--bg); border-right:1px solid var(--line);
    z-index:1040; box-shadow:0 6px 24px rgba(2,6,23,.06);
    transition:transform .28s ease,width .28s ease; will-change: transform, width;
    display:flex; flex-direction:column;  /* ⬅ make it a column layout */
    min-height:calc(100dvh - 56px);
  }
  .inv-sidebar .head{display:flex; align-items:center; gap:.85rem; padding:16px var(--gutter); border-bottom:1px solid var(--line)}
  .inv-sidebar .head .avatar{width:42px; height:42px; border-radius:12px; background:#eef2ff; display:grid; place-items:center; color:#3730a3}
  .inv-sidebar .brand{font-weight:700}

  /* Scrollable menu area */
  .inv-menu{
    flex:1 1 auto;               /* ⬅ take remaining height */
    padding:8px;
    overflow-y:auto;              /* ⬅ scroll here */
    -webkit-overflow-scrolling:touch;
  }
  .inv-menu::-webkit-scrollbar{ width:10px }
  .inv-menu::-webkit-scrollbar-thumb{ background:#e5e7eb; border-radius:8px }
  .inv-menu:hover::-webkit-scrollbar-thumb{ background:#d1d5db }

  .inv-link{
    display:flex; align-items:center; gap:.9rem; padding:1rem 1.1rem; margin:.3rem 8px;
    border-radius:.9rem; color:var(--ink); min-height:48px; position:relative; overflow:hidden;
    transition:transform .12s ease, background-color .15s ease, box-shadow .15s ease;
    font-size:1rem;
  }
  .inv-link i{font-size:1.2rem}
  .inv-link .label{white-space:nowrap}
  .inv-link:hover{background:#f1f5f9; transform:translateY(-1px)}
  .inv-link:active{transform:translateY(0)}
  .inv-link:focus-visible{outline:2px solid #cfe3ff; outline-offset:2px}
  .inv-link.active{background:#e7f1ff; color:#0b63d1; box-shadow:0 6px 20px rgba(13,110,253,.08)}
  .ripple{ position:absolute; border-radius:50%; transform:scale(0); opacity:.25; background:currentColor; animation:ripple .6s ease-out }
  @keyframes ripple{ to{ transform:scale(10); opacity:0 } }

  /* Footer is fixed to bottom of sidebar column, always visible */
  .inv-footer{
    flex:0 0 auto;
    padding:12px;
    border-top:1px solid var(--line);
    background:var(--bg);
  }
  .inv-footer a{ color:var(--ink); display:inline-flex; align-items:center; gap:.5rem }

  /* Content area */
  .inv-content{ margin-left:var(--sidebar-w); transition:margin-left .28s ease }
  .inv-page{ padding: calc(56px + 16px) var(--gutter) var(--gutter); }
  .page-header{ font-weight:700; margin-bottom:12px }

  /* Desktop collapse */
  @media (min-width: 992px){
    .inv-topbar{ left:var(--sidebar-w) }
    body.inv-collapsed .inv-topbar{ left:var(--sidebar-w-collapsed) }
    body.inv-collapsed .inv-sidebar{ width:var(--sidebar-w-collapsed) }
    body.inv-collapsed .inv-content{ margin-left:var(--sidebar-w-collapsed) }
    body.inv-collapsed .inv-link .label,
    body.inv-collapsed .brand,
    body.inv-collapsed .head .sub{
      opacity:0; width:0; margin:0; overflow:hidden
    }
    body.inv-collapsed .inv-link{ justify-content:center }
    body.inv-collapsed .inv-link i{ margin:0 }
  }

  /* Mobile off-canvas */
  @media (max-width: 992px){
    .inv-sidebar{ width:var(--sidebar-mobile); transform:translateX(-100%) }
    body.inv-open .inv-sidebar{ transform:translateX(0) }
    .inv-content{ margin-left:0 }
    .inv-topbar{ left:0 }
  }

  /* Overlay (mobile) */
  .inv-overlay{ display:none; position:fixed; inset:56px 0 0 0; background:rgba(2,6,23,.38);
                z-index:1030; opacity:0; pointer-events:none; transition:opacity .25s ease }
  body.inv-open .inv-overlay{ display:block; opacity:1; pointer-events:auto }

  @media (prefers-reduced-motion: reduce){
    .inv-sidebar, .inv-content, .inv-overlay, .inv-hambtn .hamburger span{ transition:none !important }
    .inv-link{ transition:none !important }
  }
</style>

<!-- Topbar -->
<header class="inv-topbar" role="banner">
  <button class="inv-hambtn" id="invHambtn" aria-label="Toggle navigation" aria-controls="invSidebar" aria-expanded="true" title="Toggle menu">
    <span class="hamburger" aria-hidden="true"><span></span><span></span><span></span></span>
  </button>

  <div class="inv-top-title">Inventory</div>
  <div class="inv-top-spacer"></div>

  <div class="inv-top-user d-none d-sm-block">
    {{ username or session.get('inventory_name','User') }}
  </div>

  <a href="#" class="btn btn-sm btn-outline-danger ms-1" onclick="return invLogout(event)">
    <i class="bi bi-box-arrow-right"></i> Logout
  </a>
</header>

<!-- Sidebar -->
<aside class="inv-sidebar" id="invSidebar" role="navigation" aria-label="Inventory navigation">
  <div class="head">
    <div class="avatar"><i class="bi bi-box-seam"></i></div>
    <div>
      <div class="brand">Inventory</div>
      <div class="sub small text-muted">Hi, {{ username or session.get('inventory_name','User') }}</div>
    </div>
  </div>

  <!-- Scrollable list -->
  <nav class="inv-menu" id="invMenu">
    <div class="inv-footer d-flex justify-content-between align-items-center">
    <a href="/inventory/dashboard" class="text-decoration-none small">
      <i class="bi bi-speedometer2"></i> <span class="label">Home</span>
    </a>
  </div>
    <a class="inv-link {{ 'active' if request.path == '/add_inventory' else '' }}" href="/add_inventory"
       {% if request.path == '/add_inventory' %}aria-current="page"{% endif %}>
      <i class="bi bi-boxes"></i><span class="label">Add Pro. to Warehouse</span>
    </a>

    <a class="inv-link {{ 'active' if request.path == '/add_product' else '' }}" href="/add_product"
       {% if request.path == '/add_product' %}aria-current="page"{% endif %}>
      <i class="bi bi-bag-plus"></i><span class="label">Add Product</span>
    </a>

    <a class="inv-link {{ 'active' if request.path == '/transfer_product' else '' }}" href="/transfer_product"
       {% if request.path == '/transfer_product' %}aria-current="page"{% endif %}>
      <i class="bi bi-arrow-left-right"></i><span class="label">Transfer Product</span>
    </a>

    <a class="inv-link {{ 'active' if request.path == '/close_card' else '' }}" href="/close_card"
       {% if request.path == '/close_card' %}aria-current="page"{% endif %}>
      <i class="bi bi-x-octagon"></i><span class="label">Close Card</span>
    </a>

    <a class="inv-link {{ 'active' if request.path == '/finished_report' else '' }}" href="/view/packages"
       {% if request.path == '/finished_report' %}aria-current="page"{% endif %}>
      <i class="bi bi-file-earmark-check"></i><span class="label">Packages Report</span>
    </a>

    <a class="inv-link {{ 'active' if request.path == '/inventory_products' else '' }}" href="/inventory_products"
       {% if request.path == '/inventory_products' %}aria-current="page"{% endif %}>
      <i class="bi bi-grid-3x3-gap"></i><span class="label">Inventory Products</span>
    </a>

    <a class="inv-link {{ 'active' if request.path == '/added_products' else '' }}" href="/added_products"
       {% if request.path == '/added_products' %}aria-current="page"{% endif %}>
      <i class="bi bi-journal-check"></i><span class="label">Added Products</span>
    </a>

    <a class="inv-link {{ 'active' if request.path.startswith('/admin/topups') else '' }}" href="/admin/topups"
       {% if request.path.startswith('/admin/topups') %}aria-current="page"{% endif %}>
      <i class="bi bi-lightning-charge"></i><span class="label">Top-ups</span>
    </a>

    <!-- Add as many links as needed; the area will scroll -->
  </nav>

  <!-- Always-visible footer (does NOT scroll away) -->
  
</aside>

<!-- Overlay (mobile) -->
<div class="inv-overlay" id="invOverlay" aria-hidden="true"></div>

<script>
  (function () {
    const body     = document.body;
    const overlay  = document.getElementById('invOverlay');
    const sidebar  = document.getElementById('invSidebar');
    const hambtn   = document.getElementById('invHambtn');
    const mqDesktop= window.matchMedia('(min-width: 992px)');
    const menu     = document.getElementById('invMenu');

    function applyPersisted(){
      if (mqDesktop.matches){
        const collapsed = localStorage.getItem('invCollapsed') === '1';
        body.classList.toggle('inv-collapsed', collapsed);
        hambtn?.setAttribute('aria-expanded', String(!collapsed));
      }else{
        body.classList.remove('inv-collapsed');
        hambtn?.setAttribute('aria-expanded', String(body.classList.contains('inv-open')));
      }
    }
    applyPersisted();

    function openMobile(open){
      const want = (typeof open === 'boolean') ? open : !body.classList.contains('inv-open');
      body.classList.toggle('inv-open', want);
      sidebar?.setAttribute('aria-hidden', String(!want));
      hambtn?.setAttribute('aria-expanded', String(want));
    }
    function toggleDesktop(){
      const collapse = !body.classList.contains('inv-collapsed');
      body.classList.toggle('inv-collapsed', collapse);
      localStorage.setItem('invCollapsed', collapse ? '1' : '0');
      hambtn?.setAttribute('aria-expanded', String(!collapse));
    }

    hambtn.addEventListener('click', (e)=>{ e.preventDefault(); mqDesktop.matches ? toggleDesktop() : openMobile(); });
    hambtn.addEventListener('keydown', (e)=>{ if (e.key === 'Enter' || e.key === ' '){ e.preventDefault(); mqDesktop.matches ? toggleDesktop() : openMobile(); } });

    overlay.addEventListener('click', ()=> openMobile(false));
    document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') openMobile(false); });

    /* Keyboard nav inside the scrollable list */
    function linkNodes(){
      return Array.from(menu.querySelectorAll('.inv-link'));
    }
    menu.addEventListener('keydown', (e)=>{
      const L = linkNodes(); const i = L.indexOf(document.activeElement);
      if (e.key === 'ArrowDown'){ e.preventDefault(); (L[i+1]||L[0])?.focus(); }
      if (e.key === 'ArrowUp'){ e.preventDefault(); (L[i-1]||L[L.length-1])?.focus(); }
      if (e.key === 'Home'){ e.preventDefault(); L[0]?.focus(); }
      if (e.key === 'End'){ e.preventDefault(); L[L.length-1]?.focus(); }
    });

    /* Ripple on click (menu + footer) */
    function addRipple(container){
      container.addEventListener('click', function(e){
        const a = e.target.closest('a.inv-link, .inv-footer a'); if (!a) return;
        const r = document.createElement('span'); r.className = 'ripple';
        const rect = a.getBoundingClientRect(); const size = Math.max(rect.width, rect.height);
        r.style.width = r.style.height = size + 'px';
        const x = (e.clientX || rect.left + rect.width/2) - rect.left - size/2;
        const y = (e.clientY || rect.top + rect.height/2) - rect.top - size/2;
        r.style.left = x + 'px'; r.style.top = y + 'px';
        a.appendChild(r); r.addEventListener('animationend', ()=> r.remove());
      });
    }
    addRipple(menu);
    addRipple(sidebar);

    /* Logout */
    window.invLogout = function(ev){
      ev && ev.preventDefault();
      if (confirm('Log out now?')) window.location.href = "{{ url_for('login.logout') }}";
      return false;
    };

    /* On breakpoint change, close drawer and re-apply persisted state */
    mqDesktop.addEventListener('change', ()=>{ body.classList.remove('inv-open'); applyPersisted(); });
  })();
</script>
