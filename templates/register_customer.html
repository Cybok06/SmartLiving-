<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register Customer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" type="image/png" href="https://res.cloudinary.com/dljpgzbto/image/upload/v1743993646/company-logo_dksb23.jpg">

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f8ff;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s, color 0.3s;
        }

        body.dark-mode {
            background-color: #121212;
            color: #ffffff;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-top: 30px;
        }

        .container {
            width: 50%;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            opacity: 0;
            animation: slideIn 1s forwards;
        }

        .container.dark-mode {
            background-color: #333;
        }

        @keyframes slideIn {
            0% { transform: translateY(20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        label {
            font-weight: bold;
            margin-top: 10px;
            display: block;
        }

        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }

        textarea {
            height: 120px;
        }

        .button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }

        .button:hover {
            background-color: #45a049;
        }

        .message {
            text-align: center;
            margin-top: 20px;
        }

        .success {
            color: green;
        }

        .error {
            color: red;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group input, .form-group textarea {
            font-size: 14px;
        }

        footer {
            background-color: #8a2be2;
            color: white;
            padding: 10px 0;
            text-align: center;
            position: relative;
            bottom: 0;
            width: 100%;
        }

        @media (max-width: 768px) {
            .container {
                width: 80%;
            }

            .navbar-brand span {
                font-size: 1.2rem;
            }

            .button {
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .container {
                width: 95%;
            }

            .navbar-brand span {
                font-size: 1rem;
            }
        }
        .floating-message {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background-color: #28a745;
  color: white;
  padding: 12px 25px;
  border-radius: 8px;
  font-weight: bold;
  font-size: 16px;
  display: none;
  z-index: 9999;
  animation: fadeInOut 4s ease-in-out forwards;
}

.floating-message.error {
  background-color: #dc3545;
}

@keyframes fadeInOut {
  0% { opacity: 0; transform: translate(-50%, -20px); }
  10% { opacity: 1; transform: translate(-50%, 0); }
  90% { opacity: 1; transform: translate(-50%, 0); }
  100% { opacity: 0; transform: translate(-50%, -20px); }
}

    </style>
</head>
<body>

{% include 'side_bar.html' %}

<div id="message" class="floating-message"></div>

<h1>Register Customer</h1>
<div class="container">
  <form id="customerForm" method="POST" action="/customer/add" enctype="multipart/form-data">
    <div class="form-group">
      <label for="name">Full Name</label>
      <input type="text" id="name" name="name" required placeholder="Enter customer name">
    </div>

    <div class="form-group">
      <label for="image">Upload Image</label>
      <input type="file" id="image" name="image" accept="image/*" required>
      <p id="upload-status" style="font-size: 0.9em; color: #086b2e;"></p>
    </div>

    <div class="form-group">
      <label for="location">Location</label>
      <input type="text" id="location" name="location" required placeholder="Enter location">
    </div>

    <div class="form-group">
      <label for="occupation">Occupation</label>
      <input type="text" id="occupation" name="occupation" required placeholder="Enter occupation">
    </div>

    <div class="form-group">
      <label for="phone_number">Phone Number</label>
      <input type="tel" id="phone_number" name="phone_number" required placeholder="Enter phone number">
    </div>

    <div class="form-group">
      <label for="comment">Additional Comments</label>
      <textarea id="comment" name="comment" placeholder="Enter any additional comments"></textarea>
    </div>

    <input type="hidden" name="agent_id" id="agent_id" value="{{ agent_id }}">
    <input type="hidden" name="latitude" id="latitude">
    <input type="hidden" name="longitude" id="longitude">

    <button type="submit" class="button">Register Customer</button>
  </form>
</div>

<!-- Confirmation Modal -->
<div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="confirmModalLabel">Confirm Customer Registration</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p><strong>Full Name:</strong> <span id="confName"></span></p>
        <p><strong>Phone:</strong> <span id="confPhone"></span></p>
        <p><strong>Location:</strong> <span id="confLocation"></span></p>
        <p><strong>Occupation:</strong> <span id="confOccupation"></span></p>
        <p><strong>Comments:</strong> <span id="confComment"></span></p>
        <p><strong>Image:</strong><br>
          <img id="confImage" src="" alt="Customer Image" class="img-fluid rounded" style="max-height: 200px; border: 1px solid #ccc;">
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Edit</button>
        <button type="button" class="btn btn-success d-flex align-items-center" id="confirmSubmit">
          <span class="spinner-border spinner-border-sm me-2 d-none" role="status" id="spinner" aria-hidden="true"></span>
          <span id="btn-text">Confirm & Register</span>
        </button>
      </div>
    </div>
  </div>
</div>

<footer>
    <p>&copy; 2025 SMART LIVING. All Rights Reserved.</p>
</footer>

<script>
  // Preview image when selected
  document.getElementById('image').addEventListener('change', function (event) {
    const file = event.target.files[0];
    if (file) {
      const previewURL = URL.createObjectURL(file);
      document.getElementById('confImage').src = previewURL;
      document.getElementById('upload-status').textContent = "✅ Image selected.";
    }
  });

  // Show confirmation modal before submission
  document.getElementById('customerForm').addEventListener('submit', function (event) {
    event.preventDefault();

    const name = document.getElementById('name').value.trim();
    const location = document.getElementById('location').value.trim();
    const occupation = document.getElementById('occupation').value.trim();
    const phoneNumber = document.getElementById('phone_number').value.trim();
    const comment = document.getElementById('comment').value.trim();
    const imageInput = document.getElementById('image');

    if (!name || !location || !occupation || !phoneNumber || !imageInput.files.length) {
      showMessage('Please fill out all required fields.', 'error');
      return;
    }

    // Fill modal with preview
    document.getElementById('confName').textContent = name;
    document.getElementById('confPhone').textContent = phoneNumber;
    document.getElementById('confLocation').textContent = location;
    document.getElementById('confOccupation').textContent = occupation;
    document.getElementById('confComment').textContent = comment || 'N/A';

    // Show confirmation modal
    const modal = new bootstrap.Modal(document.getElementById('confirmModal'));
    modal.show();

    // Confirm button click
    document.getElementById('confirmSubmit').onclick = function () {
      const form = document.getElementById('customerForm');
      const formData = new FormData(form);

      const btn = document.getElementById('confirmSubmit');
      const spinner = document.getElementById('spinner');
      const btnText = document.getElementById('btn-text');

      spinner.classList.remove('d-none');
      btnText.textContent = "Registering...";
      btn.disabled = true;

      fetch('/customer/add', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        const modalInstance = bootstrap.Modal.getInstance(document.getElementById('confirmModal'));
        modalInstance.hide();

        spinner.classList.add('d-none');
        btnText.textContent = "Confirm & Register";
        btn.disabled = false;

        if (data.message) {
          showMessage('✅ Registered Successfully.', 'success');
          form.reset();
          document.getElementById('confImage').src = "";
          setTimeout(() => {
            document.getElementById('upload-status').textContent = '';
          }, 2000);
        } else {
          showMessage(data.error || 'Something went wrong, please try again.', 'error');
        }
      })
      .catch(error => {
        const modalInstance = bootstrap.Modal.getInstance(document.getElementById('confirmModal'));
        modalInstance.hide();

        spinner.classList.add('d-none');
        btnText.textContent = "Confirm & Register";
        btn.disabled = false;

        showMessage('Error: ' + error.message, 'error');
      });
    };
  });

  // Show floating message
  function showMessage(message, type) {
    const el = document.getElementById('message');
    el.textContent = message;
    el.className = `floating-message ${type}`;
    el.style.display = 'block';
    setTimeout(() => {
      el.style.display = 'none';
    }, 4000);
  }

  // Get location on page load
  window.addEventListener('load', () => {
    if ("geolocation" in navigator) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          document.getElementById('latitude').value = position.coords.latitude.toFixed(6);
          document.getElementById('longitude').value = position.coords.longitude.toFixed(6);
        },
        (error) => {
          alert("⚠️ Location access denied or unavailable.");
        },
        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
      );
    }
  });
</script>



<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
<script>
    window.cbConfig = {
        chatId: "acac0de2-5c91-4eae-9354-1376e3093d91"
    };
</script>
<script src="https://app.chatbit.co/embed.min.js" defer></script>
</body>
</html>
