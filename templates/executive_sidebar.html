<!-- executive_sidebar.html -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />

<style>
  .sidebar {
    position: fixed; top: 0; left: 0; width: 250px; height: 100vh;
    background-color: #ffffff; color: #2c3e50; padding: 1rem;
    box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
    transition: left 0.3s ease-in-out; z-index: 1050;
    display: flex; flex-direction: column;
  }

  .sidebar-body {
    flex: 1 1 auto; overflow-y: auto; -webkit-overflow-scrolling: touch;
    padding-right: 0.25rem; margin-right: -0.25rem; padding-bottom: 1rem;
  }

  .sidebar-body::-webkit-scrollbar { width: 8px; }
  .sidebar-body::-webkit-scrollbar-thumb { background: #e0e6f6; border-radius: 8px; }
  .sidebar-body:hover::-webkit-scrollbar-thumb { background: #c9d5fa; }

  .sidebar.collapsed { left: -260px; }

  .sidebar-header { display: flex; flex-direction: column; align-items: center; margin-bottom: 0.75rem; flex: 0 0 auto; }
  .sidebar-header img { width: 50px; height: 50px; object-fit: contain; border-radius: 50%; }
  .sidebar-header strong { margin-top: 0.5rem; font-size: 1.1rem; color: #007bff; font-weight: 600; }

  .nav-section {
    font-size: 0.75rem; text-transform: uppercase; color: #888;
    margin: 1.25rem 0 0.5rem; padding-left: 0.75rem; font-weight: 600;
  }

  .sidebar a {
    display: flex; align-items: center; color: #2c3e50; text-decoration: none;
    padding: 0.55rem 0.75rem; font-size: 0.95rem; font-weight: 500;
    border-radius: 6px; transition: background-color 0.2s ease, color 0.2s ease;
  }
  .sidebar a:hover { background-color: #f0f4ff; color: #007bff; }
  .sidebar a.text-primary { background-color: #e8f0fe; color: #007bff; }

  .sidebar a i { width: 25px; text-align: center; margin-right: 10px; color: #007bff; font-size: 1.1rem; }

  .sidebar-toggle {
    position: fixed; top: 1rem; left: 260px; background-color: #007bff; color: #fff;
    border: none; z-index: 1100; border-radius: 50%; width: 40px; height: 40px;
    font-size: 1.25rem; display: flex; align-items: center; justify-content: center;
    transition: left 0.3s ease-in-out;
  }
  .sidebar.collapsed + .sidebar-toggle { left: 10px; }

  @media (max-width: 768px) {
    .sidebar { left: -260px; }
    .sidebar-toggle { left: 10px; }
    body.sidebar-open .sidebar { left: 0; }
    body.sidebar-open .sidebar-toggle { left: 260px; }
  }

  /* Badge for unconfirmed count */
  .notif-badge {
    margin-left: auto;
    background: #dc3545; /* danger */
    color: #fff;
    border-radius: 999px;
    padding: 0.2rem 0.5rem;
    font-size: 0.75rem;
    font-weight: 700;
  }
</style>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <img src="https://res.cloudinary.com/dljpgzbto/image/upload/v1743993646/company-logo_dksb23.jpg" alt="SmartLiving Logo" />
    <strong>SMARTLIVING</strong>
  </div>

  <div class="sidebar-body">
    <div class="nav-section">Navigation</div>
    <a href="/executive/dashboard" class="{% if request.path == '/executive/dashboard' %}text-primary fw-bold{% endif %}">
      <i class="bi bi-speedometer2"></i> Dashboard
    </a>
<!-- NEW: Deposit Confirmations with live badge + tooltip -->
    <a href="{{ url_for('executive_deposits.list_view') }}"
       class="{% if request.path.startswith('/executive/deposits') %}text-primary fw-bold{% endif %}"
       id="depositLink" title="Unconfirmed deposits">
      <i class="bi bi-bank"></i> Deposit Confirmations
      <span id="unconfBadge" class="notif-badge d-none">0</span>
    </a>

    <div class="nav-section">Target</div>
    <a href="/executive/target/set" class="{% if request.path == '/executive/target/set' %}text-primary fw-bold{% endif %}">
      <i class="bi bi-bullseye"></i> Set Target
    </a>
    <a href="/view_targets" class="{% if request.path == '/view_targets' %}text-primary fw-bold{% endif %}">
      <i class="bi bi-person-badge"></i> Targets
    </a>
    <a href="{{ url_for('executive_agent_target.executive_agent_targets_home') }}"
       class="{% if request.path == url_for('executive_agent_target.executive_agent_targets_home') %}text-primary fw-bold{% endif %}">
      <i class="bi bi-eye"></i> Agent Targets & Commission
    </a>

    <div class="nav-section">Reports</div>
    <a href="/executive/sales" class="{% if request.path == '/executive/sales' %}text-primary fw-bold{% endif %}">
      <i class="bi bi-graph-up-arrow"></i> Sales
    </a>
    <a href="/executive/customers" class="{% if request.path == '/executive/customers' %}text-primary fw-bold{% endif %}">
      <i class="bi bi-people"></i> Customers
    </a>
    <a href="/executive/tasks" class="{% if request.path == '/executive/tasks' %}text-primary fw-bold{% endif %}">
      <i class="bi bi-check2-circle"></i> Tasks
    </a>

    <div class="nav-section">Collections</div>
    <a href="{{ url_for('executive_sales_close.executive_close_page') }}"
       class="{% if request.path.startswith('/executive-close') %}text-primary fw-bold{% endif %}">
      <i class="bi bi-cash-coin"></i> Sales Close
    </a>

    
    <div style="height: 12px;"></div>
  </div>
</div>

<!-- Toggle Button -->
<button class="sidebar-toggle" onclick="toggleSidebar()" id="sidebarToggle">
  <i class="bi bi-list"></i>
</button>

<script>
  function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    sidebar.classList.toggle('collapsed');
    document.body.classList.toggle('sidebar-open');
  }

  // --- Live badge updater ---
  async function refreshUnconfirmedBadge() {
    try {
      const res = await fetch("{{ url_for('executive_deposits.unconfirmed_count') }}", { credentials: 'same-origin' });
      if (!res.ok) throw new Error('HTTP ' + res.status);
      const data = await res.json();
      const n = Number(data.count || 0);

      const badge = document.getElementById('unconfBadge');
      badge.textContent = n;
      if (n > 0) {
        badge.classList.remove('d-none');
      } else {
        badge.classList.add('d-none');
      }

      const link = document.getElementById('depositLink');
      if (link) link.setAttribute('title', n > 0 ? n + ' unconfirmed deposit(s)' : 'No unconfirmed deposits');
    } catch (e) {
      // fail silently; keep previous value
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    refreshUnconfirmedBadge();
    // poll every 30s
    setInterval(refreshUnconfirmedBadge, 30000);
  });
</script>
