<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Customers - CRM System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="https://res.cloudinary.com/dljpgzbto/image/upload/v1743993646/company-logo_dksb23.jpg" type="image/png"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f7fa;
      color: #222;
      transition: background 0.3s, color 0.3s;
    }
    .dark-mode { background-color: #121212; color: #f1f1f1; }
    .dark-mode .customer-card { background: #1f1f1f; }

    .navbar-brand img { height: 40px; margin-right: 10px; }

    .summary {
      display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 20px;
      font-weight: bold; font-size: 16px;
    }
    .summary div {
      background: #007bff;
      color: white;
      padding: 8px 15px;
      border-radius: 6px;
    }

    .status-filters {
      margin-bottom: 20px;
    }
    .status-filters .btn {
      min-width: 100px;
    }

    .customer-list {
      display: flex; flex-wrap: wrap; gap: 15px;
    }
    .customer-link {
      text-decoration: none;
      color: inherit;
      flex: 0 0 auto;
    }
    .customer-card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      padding: 15px;
      width: 250px;
      display: flex;
      align-items: center;
      gap: 15px;
      transition: transform 0.2s;
    }
    .customer-card:hover { transform: scale(1.02); }

    .customer-card img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #007bff;
    }
    .customer-info { flex-grow: 1; }
    .customer-name {
      font-size: 18px;
      font-weight: 600;
      margin: 0 0 5px 0;
    }
    .customer-phone { font-size: 14px; color: #555; }

    .status-label {
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 12px;
      color: white;
      user-select: none;
    }
    .status-active { background-color: #28a745; }
    .status-not-active { background-color: #dc3545; }
    .status-overdue { background-color: #ffc107; color: black; }

    .pagination .page-link { color: #007bff; }
    .pagination .active .page-link {
      background-color: #007bff;
      color: white;
      border-color: #007bff;
    }

    @media (max-width: 600px) {
      .customer-card {
        flex-direction: column;
        align-items: flex-start;
        width: 100%;
      }
    }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-light px-3 shadow-sm mb-4">
  <a class="navbar-brand d-flex align-items-center" href="{{ url_for('manager_dashboard.manager_dashboard_view') }}">
    <img src="https://res.cloudinary.com/dljpgzbto/image/upload/v1743993646/company-logo_dksb23.jpg" alt="logo"> Dashboard
  </a>
  <div class="ms-auto">
    <button class="btn btn-outline-dark" onclick="toggleDarkMode()" id="modeToggle">ðŸŒ™</button>
  </div>
</nav>

<h1 class="mb-4">Customers List</h1>

<!-- Filter and Search Form -->
<form method="GET" class="row g-3 mb-4">
  <div class="col-md-4">

  </div>

  <div class="col-md-4">
    <input type="text" name="search" class="form-control" placeholder="Search by name or phone..." value="{{ search_term }}">
  </div>

  <div class="col-md-2 d-grid">
    <button class="btn btn-primary" type="submit">Apply</button>
  </div>

  <div class="col-md-2 d-grid">
    <a href="{{ url_for('customers.customers_list') }}" class="btn btn-outline-secondary">Reset</a>
  </div>
</form>

<!-- Status Filter Buttons -->
<div class="status-filters btn-group mb-4">
  <a class="btn btn-outline-primary {% if not selected_status %}active{% endif %}" href="{{ url_for('customers.customers_list', agent_id=selected_agent, search=search_term) }}">All</a>
  <a class="btn btn-outline-success {% if selected_status == 'active' %}active{% endif %}" href="{{ url_for('customers.customers_list', agent_id=selected_agent, search=search_term, status='active') }}">Active</a>
  <a class="btn btn-outline-danger {% if selected_status == 'not active' %}active{% endif %}" href="{{ url_for('customers.customers_list', agent_id=selected_agent, search=search_term, status='not active') }}">Not Active</a>
  <a class="btn btn-outline-warning {% if selected_status == 'overdue' %}active{% endif %}" href="{{ url_for('customers.customers_list', agent_id=selected_agent, search=search_term, status='overdue') }}">Overdue</a>
</div>

<!-- Summary -->
<div class="summary">
  <div>Total: {{ total_customers }}</div>
  <div class="bg-success">Active: {{ total_active }}</div>
  <div class="bg-danger">Not Active: {{ total_not_active }}</div>
  <div class="bg-warning text-dark">Overdue: {{ total_overdue }}</div>
</div>

<!-- Customer Cards -->
<div class="customer-list">
  {% for customer in customers %}
  <a href="{{ url_for('customers.customer_profile', customer_id=customer.id) }}" class="customer-link">
    <div class="customer-card">
      <img src="{{ customer.image_url }}" onerror="this.src='https://via.placeholder.com/80';" alt="{{ customer.name }}">
      <div class="customer-info">
        <p class="customer-name">{{ customer.name }}</p>
        <p class="customer-phone">{{ customer.phone }}</p>
      </div>
      <div class="status-label
        {% if customer.status == 'Active' %}status-active
        {% elif customer.status == 'Overdue' %}status-overdue
        {% else %}status-not-active{% endif %}">
        {{ customer.status }}
      </div>
    </div>
  </a>
  {% else %}
    <p class="text-muted">No customers found.</p>
  {% endfor %}
</div>

<!-- Pagination -->
{% if total_pages > 1 %}
<nav aria-label="Pagination" class="mt-4">
  <ul class="pagination justify-content-center">
    {% if page > 1 %}
    <li class="page-item">
      <a class="page-link" href="{{ url_for('customers.customers_list', page=page-1, search=search_term, agent_id=selected_agent, status=selected_status) }}">Previous</a>
    </li>
    {% endif %}
    {% for p in range(1, total_pages + 1) %}
    <li class="page-item {% if p == page %}active{% endif %}">
      <a class="page-link" href="{{ url_for('customers.customers_list', page=p, search=search_term, agent_id=selected_agent, status=selected_status) }}">{{ p }}</a>
    </li>
    {% endfor %}
    {% if page < total_pages %}
    <li class="page-item">
      <a class="page-link" href="{{ url_for('customers.customers_list', page=page+1, search=search_term, agent_id=selected_agent, status=selected_status) }}">Next</a>
    </li>
    {% endif %}
  </ul>
</nav>
{% endif %}

<script>
  function toggleDarkMode() {
    const body = document.body;
    const btn = document.getElementById('modeToggle');
    body.classList.toggle('dark-mode');
    btn.textContent = body.classList.contains('dark-mode') ? 'ðŸŒž' : 'ðŸŒ™';
  }
</script>

</body>
</html>

